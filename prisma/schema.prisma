datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model ModemDevice {
  id           Int      @id @default(autoincrement())
  imei         String   @unique
  serialNumber String   @unique
  status       String
  currentSim   SimCard? @relation(fields: [currentSimId], references: [id])
  currentSimId Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  history ModemSimHistory[]
  sms     SmsIncoming[]
}

model SimCard {
  id          Int      @id @default(autoincrement())
  phoneNumber String   @unique
  provider    String
  status      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  history     ModemSimHistory[]
  sms         SmsIncoming[]
  ModemDevice ModemDevice[]
}

model ModemSimHistory {
  id             Int         @id @default(autoincrement())
  modemDevice    ModemDevice @relation(fields: [modemId], references: [id])
  modemId        Int
  simCard        SimCard     @relation(fields: [simId], references: [id])
  simId          Int
  connectedAt    DateTime    @default(now())
  disconnectedAt DateTime?
}

model SmsIncoming {
  id            Int         @id @default(autoincrement())
  modemDevice   ModemDevice @relation(fields: [modemDeviceId], references: [id])
  modemDeviceId Int
  simCard       SimCard     @relation(fields: [simCardId], references: [id])
  simCardId     Int
  sender        String
  receivedAt    DateTime    @map("received_at")
  text          String
  expire        Boolean     @default(true)

  @@index([modemDeviceId, expire])
  @@index([simCardId, expire])
}
